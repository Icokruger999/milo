{
  "InstanceIds": ["i-06bc5b2218c041802"],
  "DocumentName": "AWS-RunShellScript",
  "Comment": "Force create Flakes table",
  "Parameters": {
    "commands": [
      "#!/bin/bash",
      "echo 'Force creating Flakes table...'",
      "sudo -u postgres psql MiloDB << 'EOF'",
      "CREATE TABLE IF NOT EXISTS \"Flakes\" (",
      "    \"Id\" SERIAL PRIMARY KEY,",
      "    \"Title\" VARCHAR(500) NOT NULL,",
      "    \"Content\" VARCHAR(10000),",
      "    \"ProjectId\" INTEGER,",
      "    \"AuthorId\" INTEGER,",
      "    \"CreatedAt\" TIMESTAMP WITH TIME ZONE NOT NULL,",
      "    \"UpdatedAt\" TIMESTAMP WITH TIME ZONE,",
      "    \"IsDeleted\" BOOLEAN NOT NULL DEFAULT FALSE",
      ");",
      "CREATE INDEX IF NOT EXISTS \"IX_Flakes_ProjectId\" ON \"Flakes\" (\"ProjectId\");",
      "CREATE INDEX IF NOT EXISTS \"IX_Flakes_AuthorId\" ON \"Flakes\" (\"AuthorId\");",
      "\\dt \"Flakes\"",
      "EOF",
      "echo ''",
      "echo 'Restarting service...'",
      "sudo systemctl restart milo-api",
      "sleep 5",
      "echo ''",
      "echo 'Testing...'",
      "curl -s http://localhost:5001/api/flakes",
      "echo ''"
    ]
  }
}

